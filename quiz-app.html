<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QC Skills Test - Premium Edition</title>
    <!-- ·ûî·ûì·üí·ûê·üÇ·ûò·ûè·üí·ûö·ûÑ·üã·ûá·ûΩ·ûö·ûë·û∏ ·üß ·ûì·üÉ·ûÄ·ûº·ûä·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="logo.png">
    <style>
        /* ===== RESET & BASE ===== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', 'Khmer OS Battambang', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Background Animation */
        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: bgMove 20s linear infinite;
            z-index: 0;
        }

        @keyframes bgMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* ===== CONTAINER ===== */
        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 520px;
            padding: 40px 35px;
            text-align: center;
            position: relative;
            z-index: 1;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== TYPOGRAPHY ===== */
        h2 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #888;
            font-size: 15px;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* ===== INPUTS ===== */
        input {
            width: 100%;
            padding: 18px 20px;
            border: 3px solid #f0f0f0;
            border-radius: 18px;
            font-size: 17px;
            font-family: 'Khmer OS Battambang', sans-serif;
            margin-bottom: 20px;
            outline: none;
            transition: all 0.3s;
            background: #fafafa;
        }

        input:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* ===== BUTTONS ===== */
        .btn-action {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 18px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(102, 126, 234, 0.5);
        }

        .btn-action:active {
            transform: translateY(0);
        }

        /* ===== SCREENS ===== */
        #quiz-box, #result-box { 
            display: none; 
            animation: fadeIn 0.4s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== QUIZ INTERFACE ===== */
        .staff-tag {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 13px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.6);
        }

        .question-counter {
            font-weight: 700;
            color: #999;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .question-counter span {
            color: #667eea;
            font-size: 18px;
        }

        /* Chinese Word Display */
        .chinese-word {
            font-size: 72px;
            font-weight: 900;
            color: #333;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 2px;
            animation: wordPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes wordPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Speaker Button */
        .speak-btn {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 26px;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(252, 182, 159, 0.4);
        }

        .speak-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(252, 182, 159, 0.6);
        }

        .speak-btn:active {
            transform: scale(0.95);
        }

        .speak-btn.playing {
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .option-btn {
            padding: 18px 10px;
            border: 3px solid #f5f5f5;
            border-radius: 18px;
            background: white;
            cursor: pointer;
            font-family: 'Khmer OS Battambang', sans-serif;
            font-weight: 700;
            font-size: 15px;
            min-height: 85px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .option-btn:hover:not(:disabled) {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;
            color: white !important;
            border-color: #11998e !important;
            animation: correctAnim 0.5s ease;
        }

        @keyframes correctAnim {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .wrong {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%) !important;
            color: white !important;
            border-color: #eb3349 !important;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        /* ===== RESULT SCREEN ===== */
        .result-icon {
            font-size: 80px;
            margin-bottom: 15px;
            animation: iconBounce 1s ease;
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .final-score {
            font-size: 70px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
            text-shadow: 2px 2px 10px rgba(102, 126, 234, 0.3);
        }

        .result-message {
            font-size: 18px;
            font-weight: 600;
            margin: 15px 0;
            padding: 12px 20px;
            border-radius: 15px;
            display: inline-block;
        }

        .pass {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
            color: #1e7e34;
        }

        .fail {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #bd2130;
        }

        .status-message {
            color: #27ae60;
            font-weight: 600;
            margin: 15px 0;
            font-size: 14px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 480px) {
            .container { padding: 30px 25px; }
            .chinese-word { font-size: 58px; }
            .final-score { font-size: 60px; }
            h2 { font-size: 24px; }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- ===== SCREEN 1: REGISTRATION ===== -->
        <div id="login-box">
            <h2>üìä QC Skills Test</h2>
            <p class="subtitle">·ûü·ûº·ûò·ûî·ûâ·üí·ûÖ·ûº·ûõ·ûà·üí·ûò·üÑ·üá·ûä·ûæ·ûò·üí·ûî·û∏·ûÖ·û∂·ûî·üã·ûï·üí·ûä·ûæ·ûò·ûè·üÅ·ûü·üí·ûè<br>ËØ∑ËæìÂÖ•ÂßìÂêçÂºÄÂßãÊµãËØï</p>
            <input 
                type="text" 
                id="staffName" 
                placeholder="·ûà·üí·ûòÔøΩÔøΩÔøΩ·üá·ûî·ûª·ûÇ·üí·ûÇ·ûõ·û∑·ûÄ / ÂëòÂ∑•ÂßìÂêç"
                autocomplete="off"
                maxlength="50"
            >
            <button class="btn-action" onclick="beginQuiz()">
                üöÄ ·ûÖ·û∂·ûî·üã·ûï·üí·ûä·ûæ·ûò·ûî·üí·ûö·û°·ûÑ
            </button>
        </div>

        <!-- ===== SCREEN 2: QUIZ ===== -->
        <div id="quiz-box">
            <div class="staff-tag" id="staffTag">üë§ ·ûî·üÅ·ûÄ·üí·ûÅ·ûá·ûì</div>
            <div class="progress-bar">
                <div class="progress-fill" id="pFill"></div>
            </div>
            <p class="question-counter">
                ·ûü·üÜ·ûé·ûΩ·ûö <span id="qIdx">1</span>/10
            </p>
            <div class="chinese-word" id="cnDisplay">Âä†ËΩΩ‰∏≠...</div>
            <button class="speak-btn" id="speakBtn" onclick="playVoiceManual()">üîä</button>
            <div class="options-grid" id="optGrid"></div>
        </div>

        <!-- ===== SCREEN 3: RESULT ===== -->
        <div id="result-box">
            <div class="result-icon" id="resultIcon">üèÜ</div>
            <h2 id="finalUser" style="margin-bottom: 10px;">·ûî·üÅ·ûÄ·üí·ûÅ·ûá·ûì</h2>
            <div class="final-score" id="finalScore">0/10</div>
            <div class="result-message" id="resultMsg">-</div>
            <p class="status-message">
                <span id="sendingStatus">‚úÖ ·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ·ûñ·û∑·ûì·üí·ûë·ûª·ûö·ûΩ·ûÖ·ûö·û∂·ûõ·üã</span>
            </p>
            <button class="btn-action" onclick="location.reload()" style="margin-top: 20px;">
                üîÑ ·ûí·üí·ûú·ûæ·ûè·üÅ·ûü·üí·ûè·ûò·üí·ûä·ûÑ·ûë·üÄ·ûè
            </button>
        </div>
    </div>

    <!-- ResponsiveVoice for HIGH QUALITY Chinese TTS -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=jQZ5controlled"></script>

    <script>
        // ===== DATABASE - 49 QC Terms =====
        const database = [
            { cn: "Â∑•ÂéÇ", km: "·ûö·üÑ·ûÑ·ûÖ·ûÄ·üí·ûö" }, 
            { cn: "ËΩ¶Èó¥", km: "·ûö·üÑ·ûÑ·ûá·û∂·ûÑ / ·û¢·û∂·ûÇ·û∂·ûö" }, 
            { cn: "ÂäûÂÖ¨ÂÆ§", km: "·ûÄ·û∂·ûö·û∑·ûô·û∂·ûõ·üê·ûô" },
            { cn: "Áè≠Èïø", km: "·ûî·üí·ûö·ûí·û∂·ûì·ûÄ·üí·ûö·ûª·ûò" }, 
            { cn: "ÁøªËØë", km: "·û¢·üí·ûì·ûÄ·ûî·ûÄ·ûî·üí·ûö·üÇ" }, 
            { cn: "Ê≥®ÊÑèÂÆâÂÖ®", km: "·ûî·üí·ûö·ûô·üê·ûè·üí·ûì·ûü·ûª·ûú·ûè·üí·ûê·û∑·ûó·û∂·ûñ" },
            { cn: "‰∏äÁè≠", km: "·ûÖ·ûº·ûõ·ûí·üí·ûú·ûæ·ûÄ·û∂·ûö" }, 
            { cn: "‰∏ãÁè≠", km: "·ûÖ·üÅ·ûâ·ûñ·û∏·ûí·üí·ûú·ûæ·ûÄ·û∂·ûö" }, 
            { cn: "ËØ∑ÂÅá", km: "·ûü·ûª·üÜ·ûÖ·üí·ûî·û∂·ûî·üã" },
            { cn: "ËΩ¶Êû∂", km: "·ûè·ûΩ·ûÄ·ûÑ·üã" }, 
            { cn: "ÂâçÂèâ", km: "·ûÜ·üí·ûñ·üÑ·üá·ûò·ûª·ûÅ (Fork)" }, 
            { cn: "ËΩ¶Êää", km: "·ûä·üÉ·ûÄ·ûÑ·üã" },
            { cn: "ËΩ¶Âúà", km: "·ûÅ·üí·ûì·ûÑ·ûÄ·ûÑ·üã" }, 
            { cn: "Â§ñËÉé", km: "·ûü·üÜ·ûî·ûÄ·ûÄ·ûÑ·üã" }, 
            { cn: "ËÑöË∏è", km: "·ûà·üí·ûì·û∂·ûì·üã" },
            { cn: "ÈìæÊù°", km: "·ûÖ·üí·ûö·ûú·û∂·ûÄ·üã" }, 
            { cn: "Â∫ßÂû´", km: "·ûÄ·üÇ·ûî" }, 
            { cn: "ÂàπËΩ¶", km: "·û†·üí·ûú·üí·ûö·û∂·üÜ·ûÑ" },
            { cn: "ÊµãÈáèÂÄº", km: "·ûè·ûò·üí·ûõ·üÉ·ûú·û∂·ûü·üã·ûá·û∂·ûÄ·üã·ûü·üí·ûè·üÇ·ûÑ" }, 
            { cn: "Ê†áÂáÜÂÄº", km: "·ûè·ûò·üí·ûõ·üÉ·ûü·üí·ûè·ûÑ·üã·ûä·û∂" }, 
            { cn: "‰∏äÈôê", km: "·ûä·üÇ·ûì·ûÄ·üÜ·ûé·ûè·üã ·ûõ·ûæ" },
            { cn: "‰∏ãÈôê", km: "·ûä·üÇ·ûì·ûÄ·üÜ·ûé·ûè·üã ·ûÄ·üí·ûö·üÑ·ûò" }, 
            { cn: "Ë∂ãÂäøÂõæ", km: "·ûÄ·üí·ûö·û∂·ûî·ûì·û∑·ûì·üí·ûì·û∂·ûÄ·û∂·ûö" }, 
            { cn: "ÂêàÊ†º", km: "·ûá·û∂·ûî·üã (OK)" },
            { cn: "‰∏çÂêàÊ†º", km: "·ûí·üí·ûõ·û∂·ûÄ·üã (NG)" }, 
            { cn: "ÂºÄË£Ç", km: "·ûî·üí·ûö·üÅ·üá (Crack)" }, 
            { cn: "ÁÑäÁ†¥", km: "·ûï·üí·ûü·û∂·ûí·üí·ûõ·ûª·üá" },
            { cn: "ÊºèÁÑä", km: "·ûó·üí·ûõ·üÅ·ûÖ·ûï·üí·ûü·û∂·ûö" }, 
            { cn: "ÈíàÁúº", km: "·ûó·üí·ûì·üÇ·ûÄ·ûò·üí·ûá·ûª·ûõ" }, 
            { cn: "ÂáπÈô∑", km: "·ûÄ·üÜ·ûñ·û∑·ûè / ·ûï·ûè" },
            { cn: "ÁÑäÈÅìÂÅèÂøÉ", km: "·ûï·üí·ûü·û∂·ûö·ûú·üÄ·ûÖ" }, 
            { cn: "ÁîµÂáª‰º§", km: "·ûÜ·üÅ·üá·ûò·üâ·û∂·ûü" }, 
            { cn: "Â†ÜÁÑä", km: "·ûï·üí·ûü·û∂·ûö·ûë·ûº·ûõ" },
            { cn: "Âí¨Ëæπ", km: "·ûü·üä·û∏·ûü·û∂·ûÖ·üã·ûî·üÜ·ûñ·ûÑ·üã" }, 
            { cn: "Èó¥Èöô", km: "·ûÖ·ûì·üí·ûõ·üÑ·üá / ·û†·ûæ·ûî" }, 
            { cn: "Á¢∞ÂàÆ‰º§", km: "·ûî·üâ·üá·ûë·ûÑ·üí·ûÇ·û∑·ûÖ / ·ûÄ·üÑ·ûü" },
            { cn: "ÁÑäÊ∏£", km: "·ûÄ·üÜ·ûë·üÅ·ûÖ·ûï·üí·ûü·û∂·ûö" }, 
            { cn: "Ëµ∑Ê≥°", km: "·ûñ·ûÑ / ·ûÖ·ûº·ûõ·ûÅ·üí·ûô·ûõ·üã" }, 
            { cn: "Ê†áÁ∫∏‰∏çËâØ", km: "·ûè·üÇ·ûò·ûò·û∑·ûì·ûõ·üí·û¢" },
            { cn: "‰øÆË°•Áóï", km: "·ûü·üí·ûì·û∂·ûò·ûá·ûΩ·ûü·ûá·ûª·ûõ" }, 
            { cn: "ÊùÇË¥®", km: "·ûí·ûº·ûõ·û∏ / ·ûÄ·üÜ·ûë·üÅ·ûÖ·ûÄ·üÜ·ûë·û∏" }, 
            { cn: "ËÑèÊ±°", km: "·ûî·üí·ûö·û°·û∂·ûÄ·üã" },
            { cn: "Ê†áÁ∫∏‰ΩçÁΩÆ‰∏çÂØπ", km: "·ûî·û∑·ûë·ûè·üÇ·ûò·ûÅ·ûª·ûü·ûë·û∏·ûè·û∂·üÜ·ûÑ" }, 
            { cn: "Ê†áÁ∫∏‰∏çÂØπÁß∞", km: "·ûî·û∑·ûë·ûè·üÇ·ûò·ûò·û∑·ûì·ûü·üí·ûò·ûæ·ûÇ·üí·ûì·û∂" },
            { cn: "ÈõæÈù¢", km: "·ûü·üí·ûö·û¢·û∂·ûî·üã" }, 
            { cn: "Ê©òÁöÆ", km: "·ûü·üÜ·ûî·ûÄ·ûÄ·üí·ûö·ûº·ûÖ" }, 
            { cn: "ÈíàÂ≠î", km: "·ûö·ûì·üí·ûí·ûò·üí·ûá·ûª·ûõ" },
            { cn: "Ê∂àÂÖâ‰∏çËâØ", km: "·ûë·ûπ·ûÄ·ûê·üí·ûì·û∂·üÜ·ûü·üí·ûö·û¢·û∂·ûî·üã·ûò·û∑·ûì·ûõ·üí·û¢" }, 
            { cn: "Èò≤ÊºÜ‰∏çËâØ", km: "·ûÄ·û∂·ûö·ûñ·û∂·ûö·ûë·ûπ·ûÄ·ûê·üí·ûì·û∂·üÜ·ûò·û∑·ûì·ûî·û∂·ûì·ûõ·üí·û¢" }
        ];

        // ===== STATE =====
        let quizUser = "";
        let qList = [];
        let cur = 0;
        let score = 0;

        // ===== HIGH QUALITY CHINESE VOICE =====
        function speakChinese(text) {
            // Using ResponsiveVoice for natural Chinese TTS
            if(typeof responsiveVoice !== 'undefined') {
                responsiveVoice.cancel();
                responsiveVoice.speak(text, "Chinese Female", {
                    pitch: 1,
                    rate: 0.85,
                    volume: 1
                });
            } else {
                // Fallback to Web Speech API
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = 'zh-CN';
                msg.rate = 0.8;
                msg.pitch = 1;
                window.speechSynthesis.speak(msg);
            }
        }

        function playVoiceManual() {
            if (qList[cur]) {
                const btn = document.getElementById('speakBtn');
                btn.classList.add('playing');
                speakChinese(qList[cur].cn);
                setTimeout(() => btn.classList.remove('playing'), 800);
            }
        }

        // ===== SEND SCORE TO GOOGLE SHEETS =====
        function postScore(name, pts) {
            const formID = "1FAIpQLSeDTCZHEGnvsvvkzUW30hvCE1A2O88kVUPHNzAqsAyngD0PTw";
            const url = `https://docs.google.com/forms/d/e/${formID}/formResponse`;
            const data = new FormData();
            data.append("entry.574845234", name);
            data.append("entry.499524849", pts + " / 10");
            
            fetch(url, { 
                method: "POST", 
                mode: "no-cors", 
                body: data 
            }).catch(e => console.log("Submit error:", e));
        }

        // ===== START QUIZ =====
        function beginQuiz() {
            quizUser = document.getElementById('staffName').value.trim();
            
            if(!quizUser) {
                alert("‚ö†Ô∏è ·ûü·ûº·ûò·ûî·ûâ·üí·ûÖ·ûº·ûõ·ûà·üí·ûò·üÑ·üá!\nËØ∑ËæìÂÖ•ÂßìÂêç!");
                return;
            }

            // Hide login, show quiz
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('quiz-box').style.display = 'block';
            document.getElementById('staffTag').innerText = "üë§ " + quizUser;

            // Randomize 10 questions
            qList = [...database]
                .sort(() => 0.5 - Math.random())
                .slice(0, 10);

            cur = 0;
            score = 0;
            renderQuestion();
        }

        // ===== RENDER QUESTION =====
        function renderQuestion() {
            const q = qList[cur];
            
            // Update UI
            document.getElementById('cnDisplay').innerText = q.cn;
            document.getElementById('qIdx').innerText = cur + 1;
            document.getElementById('pFill').style.width = ((cur / 10) * 100) + "%";

            // Auto-play voice after 400ms
            setTimeout(() => { 
                speakChinese(q.cn); 
            }, 400);

            // Generate 3 wrong answers + 1 correct
            let wrongOnes = database
                .filter(x => x.km !== q.km)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            let combined = [...wrongOnes, q]
                .sort(() => 0.5 - Math.random());

            // Render options
            const grid = document.getElementById('optGrid');
            grid.innerHTML = '';
            
            combined.forEach(obj => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = obj.km;
                btn.onclick = () => checkAnswer(btn, obj.km === q.km);
                grid.appendChild(btn);
            });
        }

        // ===== CHECK ANSWER =====
        function checkAnswer(btn, isCorrect) {
            // Disable all buttons
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

            if(isCorrect) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                // Show correct answer
                document.querySelectorAll('.option-btn').forEach(b => {
                    if(b.innerText === qList[cur].km) {
                        b.classList.add('correct');
                    }
                });
            }

            // Next question after 1.5s
            setTimeout(() => {
                cur++;
                if(cur < 10) {
                    renderQuestion();
                } else {
                    showResult();
                }
            }, 1500);
        }

        // ===== SHOW RESULT =====
        function showResult() {
            document.getElementById('quiz-box').style.display = 'none';
            document.getElementById('result-box').style.display = 'block';

            // Display score
            document.getElementById('finalUser').innerText = quizUser;
            document.getElementById('finalScore').innerText = score + " / 10";

            // Result message
            const msgEl = document.getElementById('resultMsg');
            const iconEl = document.getElementById('resultIcon');
            
            if(score >= 8) {
                msgEl.innerText = "üéâ ŸÖŸÖÿ™ÿßÿ≤! ·ûÜ·üí·ûì·ûæ·ûò!";
                msgEl.className = "result-message pass";
                iconEl.innerText = "üèÜ";
            } else if(score >= 6) {
                msgEl.innerText = "üëç ·ûõ·üí·û¢! ‰∏çÈîô!";
                msgEl.className = "result-message pass";
                iconEl.innerText = "‚úÖ";
            } else {
                msgEl.innerText = "üìö ·ûè·üí·ûö·ûº·ûú·ûÄ·û∂·ûö·û¢·ûì·ûª·ûú·ûè·üí·ûè·ûî·ûì·üí·ûê·üÇ·ûò";
                msgEl.className = "result-message fail";
                iconEl.innerText = "üí™";
            }

            // Send to Google Sheets
            postScore(quizUser, score);

            // Progress bar to 100%
            document.getElementById('pFill').style.width = "100%";
        }

        // ===== ENTER KEY SUPPORT =====
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('staffName').addEventListener('keypress', function(e) {
                if(e.key === 'Enter') beginQuiz();
            });
        });
    </script>

</body>
</html>

