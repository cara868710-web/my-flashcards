<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Quiz Dashboard - á”áŸ’ášá–áŸá“áŸ’á’áŸáŸ’ášá„áŸ‹á–á·á“áŸ’á‘á»á¢á¼áá¼</title>
    <style>
        /* ášá…á“á¶á”áŸá‘áŸ’á˜ášá€áŸ’áŸá¶áŠá¼á…á˜á»á“ á”áŸ‰á»á“áŸ’ááŸ‚á”á“áŸ’ááŸ‚á˜á€á¶ášáá»á”ááŸ‚á„á”á“áŸ’áá·á…á”á“áŸ’áá½á… */
        body { font-family: 'Khmer OS Battambang', sans-serif; background: #667eea; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; border-radius: 20px; padding: 30px; width: 100%; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .btn-main { background: #0051a2; color: white; border: none; padding: 15px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; }
        .input-group input { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 18px; }
        #quiz-screen, #result-screen { display: none; }
        .chinese-word { font-size: 60px; font-weight: bold; margin: 20px 0; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn { padding: 20px; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .correct { background: #2ecc71 !important; color: white; }
        .wrong { background: #e74c3c !important; color: white; }
    </style>
</head>
<body>

    <!-- áŸ¡. á•áŸ’á‘á¶áŸ†á„á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡ -->
    <div id="login-screen" class="container">
        <h1>ğŸ“Š QC Competency Test</h1>
        <div class="input-group">
            <input type="text" id="userName" placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡á”á»á‚áŸ’á‚á›á·á€ / å§“å">
        </div>
        <button class="btn-main" onclick="startTest()">á…á¶á”áŸ‹á•áŸ’áŠá¾á˜ááŸáŸáŸ’á â”</button>
    </div>

    <!-- áŸ¢. á•áŸ’á‘á¶áŸ†á„áŸáŸ†áá½áš -->
    <div id="quiz-screen" class="container">
        <p id="staffDisplayName"></p>
        <div class="chinese-word" id="displayWord">...</div>
        <div class="options-grid" id="optionsBox"></div>
    </div>

    <!-- áŸ£. á•áŸ’á‘á¶áŸ†á„á›á‘áŸ’á’á•á› -->
    <div id="result-screen" class="container">
        <h2>ğŸ† ááŸáŸáŸ’áášá½á…ášá¶á›áŸ‹!</h2>
        <h1 id="finalScore">0 / 10</h1>
        <p style="color: #666;">á›á‘áŸ’á’á•á›ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“á”á¶á‰áŸ‹á…á¼á› Google Sheets ášá½á…ášá¶á›áŸ‹áŸ”</p>
        <button class="btn-main" onclick="location.reload()">ğŸ”„ á’áŸ’áœá¾á˜áŸ’áŠá„á‘áŸ€á</button>
    </div>

    <script>
        const database = [
            { cn: "å·¥å‚", km: "ášáŸ„á„á…á€áŸ’áš" }, { cn: "è½¦é—´", km: "ášáŸ„á„á‡á¶á„" }, { cn: "åˆæ ¼", km: "á‡á¶á”áŸ‹" }, { cn: "ä¸åˆæ ¼", km: "á’áŸ’á›á¶á€áŸ‹" },
            { cn: "ç„Šæ¸£", km: "á€áŸ†á‘áŸá…á•áŸ’áŸá¶áš" }, { cn: "åˆ’ç—•", km: "áŸáŸ’á“á¶á˜á†áŸ’á€á¼á" } // áŠá¶á€áŸ‹á±áŸ’á™á‚áŸ’ášá”áŸ‹ áŸ¤áŸ© á–á¶á€áŸ’á™ášá”áŸáŸ‹á¢áŸ’á“á€
        ];

        let questions = [];
        let score = 0;
        let currentIndex = 0;
        let userName = "";

        // --- á˜á»áá„á¶ášá”á¶á‰áŸ‹á‘á·á“áŸ’á“á“áŸá™á‘áŸ… Google Sheets ---
        function sendResultToGoogle(staffName, finalScore) {
            // á”áŸ’áŠá¼áš YOUR_FORM_ID á‘áŸ…á‡á¶ ID ášá”áŸáŸ‹ Google Form á¢áŸ’á“á€
            const formURL = "https://docs.google.com/forms/u/0/d/e/YOUR_FORM_ID_HERE/formResponse";
            const formData = new FormData();

            // á”áŸ’áŠá¼áš entry.xxxx á±áŸ’á™ááŸ’ášá¼áœá“á¹á„ Form ášá”áŸáŸ‹á¢áŸ’á“á€
            formData.append("entry.12345678", staffName); // Entry ID áŸá˜áŸ’ášá¶á”áŸ‹áˆáŸ’á˜áŸ„áŸ‡
            formData.append("entry.87654321", finalScore); // Entry ID áŸá˜áŸ’ášá¶á”áŸ‹á–á·á“áŸ’á‘á»

            fetch(formURL, {
                method: "POST",
                mode: "no-cors",
                body: formData
            });
        }

        function startTest() {
            userName = document.getElementById('userName').value.trim();
            if(!userName) return alert("áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡!");
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            document.getElementById('staffDisplayName').innerText = "á”á»á‚áŸ’á‚á›á·á€áŸ– " + userName;
            
            questions = database.sort(() => 0.5 - Math.random()).slice(0, 10);
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[currentIndex];
            document.getElementById('displayWord').innerText = q.cn;
            
            let options = database.filter(x => x.km !== q.km).sort(() => 0.5 - Math.random()).slice(0, 3);
            options.push(q);
            options.sort(() => 0.5 - Math.random());

            const box = document.getElementById('optionsBox');
            box.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.km;
                btn.onclick = () => {
                    const btns = box.querySelectorAll('button');
                    btns.forEach(b => b.disabled = true);
                    if(opt.km === q.km) { btn.classList.add('correct'); score++; }
                    else { btn.classList.add('wrong'); }
                    
                    setTimeout(() => {
                        currentIndex++;
                        if(currentIndex < 10) loadQuestion();
                        else finishTest();
                    }, 1000);
                };
                box.appendChild(btn);
            });
        }

        function finishTest() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('finalScore').innerText = score + " / 10";
            
            // á áŸ…á˜á»áá„á¶ášá”á¶á‰áŸ‹á‘á·á“áŸ’á“á“áŸá™
            sendResultToGoogle(userName, score);
        }
    </script>
</body>
</html>
