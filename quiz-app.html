<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Smart Test - á”áŸ’ášá–áŸá“áŸ’á’áŸáŸ’ášá„áŸ‹á–á·á“áŸ’á‘á»áŒá¸á‡á¸áá›</title>
    <style>
        /* ==================== áŒá¸á áŸ’áŸá¶á‰á”áŸ‚á” Premium ==================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', 'Khmer OS Battambang', sans-serif;
            background: linear-gradient(135deg, #0052cc 0%, #667eea 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px;
        }
        .container {
            background: white; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%; max-width: 500px; padding: 40px; text-align: center; position: relative;
        }
        h1 { color: #0052cc; margin-bottom: 20px; font-size: 26px; }
        input {
            width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 15px;
            font-size: 18px; font-family: 'Khmer OS Battambang'; margin-bottom: 20px; outline: none;
        }
        input:focus { border-color: #0052cc; }
        .btn-start, .btn-restart {
            background: #0052cc; color: white; border: none; padding: 15px 30px;
            border-radius: 15px; font-size: 18px; cursor: pointer; font-weight: bold; width: 100%;
        }
        /* Question Styles */
        #quiz-box, #result-box { display: none; }
        .chinese-word { font-size: 70px; font-weight: bold; color: #333; margin: 20px 0; }
        .speak-btn {
            background: #eef2f7; border: none; width: 50px; height: 50px; border-radius: 50%;
            cursor: pointer; font-size: 20px; margin-bottom: 20px; transition: 0.3s;
        }
        .speak-btn:hover { background: #d0dae5; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .option-btn {
            padding: 18px; border: 2px solid #eee; border-radius: 15px; background: white;
            cursor: pointer; font-family: 'Khmer OS Battambang'; font-weight: bold; font-size: 16px;
        }
        .correct { background: #2ecc71 !important; color: white; border-color: #27ae60; }
        .wrong { background: #e74c3c !important; color: white; border-color: #c0392b; }
        .progress-bar { width: 100%; height: 8px; background: #eee; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: #2ecc71; width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

    <div class="container">
        <!-- áŸ¡. á•áŸ’á‘á¶áŸ†á„á…á»áŸ‡áˆáŸ’á˜áŸ„áŸ‡ (Login) -->
        <div id="login-box">
            <h1>ğŸ“‹ áŸáŸ’áœá¶á‚á˜á“áŸá”áŸá€áŸ’áá‡á“</h1>
            <p style="margin-bottom: 20px; color: #666;">áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡áŠá¾á˜áŸ’á”á¸á…á¶á”áŸ‹á•áŸ’áŠá¾á˜ááŸáŸáŸ’á</p>
            <input type="text" id="staffName" placeholder="áˆáŸ’á˜áŸ„áŸ‡á”á»á‚áŸ’á‚á›á·á€ / å§“å" autofocus>
            <button class="btn-start" onclick="startTest()">á…á¶á”áŸ‹á•áŸ’áŠá¾á˜á”áŸ’ášá¡á„ â”</button>
        </div>

        <!-- áŸ¢. á•áŸ’á‘á¶áŸ†á„áŸáŸ†áá½áš (Quiz) -->
        <div id="quiz-box">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <p style="font-weight: bold; color: #888;">áŸáŸ†áá½ášá‘á¸ <span id="qNum">1</span> / 10</p>
            <div class="chinese-word" id="wordDisplay">...</div>
            <button class="speak-btn" onclick="playVoice()">ğŸ”Š</button>
            <div class="options-grid" id="optionsGrid"></div>
        </div>

        <!-- áŸ£. á•áŸ’á‘á¶áŸ†á„á›á‘áŸ’á’á•á› (Result) -->
        <div id="result-box">
            <h1 style="font-size: 50px;">ğŸ†</h1>
            <h2>á›á‘áŸ’á’á•á›ášá”áŸáŸ‹á¢áŸ’á“á€</h2>
            <div id="finalScoreText" style="font-size: 60px; font-weight: bold; color: #0052cc; margin: 20px 0;">0 / 10</div>
            <p id="feedbackText" style="margin-bottom: 30px; font-weight: bold; color: #555;"></p>
            <p id="sendingLabel" style="color: #2ecc71; font-weight: bold;">ğŸ“Š á”á‰áŸ’á‡á¼á“á–á·á“áŸ’á‘á»á…á¼á› Sheet ášá½á…ášá¶á›áŸ‹!</p>
            <button class="btn-restart" onclick="location.reload()">ğŸ”„ á”áŸ’ášá¡á„á˜áŸ’áŠá„á‘áŸ€á</button>
        </div>
    </div>

    <script>
        // --- á‘á·á“áŸ’á“á“áŸá™ (áŸ¤áŸ© á–á¶á€áŸ’á™) ---
        const database = [
            { cn: "å·¥å‚", km: "ášáŸ„á„á…á€áŸ’áš" }, { cn: "è½¦é—´", km: "ášáŸ„á„á‡á¶á„ / á¢á¶á‚á¶áš" }, { cn: "åŠå…¬å®¤", km: "á€á¶ášá·á™á¶á›áŸá™" },
            { cn: "ç­é•¿", km: "á”áŸ’ášá’á¶á“á€áŸ’ášá»á˜" }, { cn: "ç¿»è¯‘", km: "á¢áŸ’á“á€á”á€á”áŸ’ášáŸ‚" }, { cn: "æ³¨æ„å®‰å…¨", km: "á”áŸ’ášá™áŸááŸ’á“áŸá»áœááŸ’áá·á—á¶á–" },
            { cn: "ä¸Šç­", km: "á…á¼á›á’áŸ’áœá¾á€á¶áš" }, { cn: "ä¸‹ç­", km: "á…áŸá‰á–á¸á’áŸ’áœá¾á€á¶áš" }, { cn: "è¯·å‡", km: "áŸá»áŸ†á…áŸ’á”á¶á”áŸ‹" },
            { cn: "è½¦æ¶", km: "áá½á€á„áŸ‹" }, { cn: "å‰å‰", km: "á†áŸ’á–áŸ„áŸ‡á˜á»á (Fork)" }, { cn: "è½¦æŠŠ", km: "áŠáŸƒá€á„áŸ‹" },
            { cn: "è½¦åœˆ", km: "ááŸ’á“á„á€á„áŸ‹" }, { cn: "å¤–èƒ", km: "áŸáŸ†á”á€á€á„áŸ‹" }, { cn: "è„šè¸", km: "áˆáŸ’á“á¶á“áŸ‹" },
            { cn: "é“¾æ¡", km: "á…áŸ’ášáœá¶á€áŸ‹" }, { cn: "åº§å«", km: "á€áŸ‚á”" }, { cn: "åˆ¹è½¦", km: "á áŸ’áœáŸ’ášá¶áŸ†á„" },
            { cn: "æµ‹é‡å€¼", km: "áá˜áŸ’á›áŸƒáœá¶áŸáŸ‹á‡á¶á€áŸ‹áŸáŸ’ááŸ‚á„" }, { cn: "æ ‡å‡†å€¼", km: "áá˜áŸ’á›áŸƒáŸáŸ’áá„áŸ‹áŠá¶" }, { cn: "ä¸Šé™", km: "áŠáŸ‚á“á€áŸ†áááŸ‹ á›á¾" },
            { cn: "ä¸‹é™", km: "áŠáŸ‚á“á€áŸ†áááŸ‹ á€áŸ’ášáŸ„á˜" }, { cn: "è¶‹åŠ¿å›¾", km: "á€áŸ’ášá¶á”á“á·á“áŸ’á“á¶á€á¶áš" }, { cn: "åˆæ ¼", km: "á‡á¶á”áŸ‹ (OK)" },
            { cn: "ä¸åˆæ ¼", km: "á’áŸ’á›á¶á€áŸ‹ (NG)" }, { cn: "å¼€è£‚", km: "á”áŸ’ášáŸáŸ‡ (Crack)" }, { cn: "ç„Šç ´", km: "á•áŸ’áŸá¶á’áŸ’á›á»áŸ‡" },
            { cn: "æ¼ç„Š", km: "á—áŸ’á›áŸá…á•áŸ’áŸá¶áš" }, { cn: "é’ˆçœ¼", km: "á—áŸ’á“áŸ‚á€á˜áŸ’á‡á»á›" }, { cn: "å‡¹é™·", km: "á€áŸ†á–á·á / á•á" },
            { cn: "ç„Šé“åå¿ƒ", km: "á•áŸ’áŸá¶ášáœáŸ€á…" }, { cn: "ç”µå‡»ä¼¤", km: "á†áŸáŸ‡á˜áŸ‰á¶áŸ" }, { cn: "å †ç„Š", km: "á•áŸ’áŸá¶ášá‘á¼á›" },
            { cn: "å’¬è¾¹", km: "áŸáŸŠá¸áŸá¶á…áŸ‹á”áŸ†á–á„áŸ‹" }, { cn: "é—´éš™", km: "á…á“áŸ’á›áŸ„áŸ‡ / á á¾á”" }, { cn: "ç¢°åˆ®ä¼¤", km: "á”áŸ‰áŸ‡á‘á„áŸ’á‚á·á… / á€áŸ„áŸ" },
            { cn: "ç„Šæ¸£", km: "á€áŸ†á‘áŸá…á•áŸ’áŸá¶áš" },
            { cn: "èµ·æ³¡", km: "á–á„ / á…á¼á›ááŸ’á™á›áŸ‹" }, { cn: "æ ‡çº¸ä¸è‰¯", km: "ááŸ‚á˜á˜á·á“á›áŸ’á¢" }, { cn: "ä¿®è¡¥ç—•", km: "áŸáŸ’á“á¶á˜á‡á½áŸá‡á»á›" },
            { cn: "æ‚è´¨", km: "á’á¼á›á¸ / á€áŸ†á‘áŸá…á€áŸ†á‘á¸" }, { cn: "è„æ±¡", km: "á”áŸ’ášá¡á¶á€áŸ‹" }, { cn: "æ ‡çº¸ä½ç½®ä¸å¯¹", km: "á”á·á‘ááŸ‚á˜áá»áŸá‘á¸áá¶áŸ†á„" },
            { cn: "æ ‡çº¸ä¸å¯¹ç§°", km: "á”á·á‘ááŸ‚á˜á˜á·á“áŸáŸ’á˜á¾á‚áŸ’á“á¶" }, { cn: "é›¾é¢", km: "áŸáŸ’ášá¢á¶á”áŸ‹" }, { cn: "æ©˜çš®", km: "áŸáŸ†á”á€á€áŸ’ášá¼á…" },
            { cn: "é’ˆå­”", km: "ášá“áŸ’á’á˜áŸ’á‡á»á›" }, { cn: "æ¶ˆå…‰ä¸è‰¯", km: "á‘á¹á€ááŸ’á“á¶áŸ†áŸáŸ’ášá¢á¶á”áŸ‹á˜á·á“á›áŸ’á¢" }, { cn: "é˜²æ¼†ä¸è‰¯", km: "á€á¶ášá–á¶ášá‘á¹á€ááŸ’á“á¶áŸ†á˜á·á“á”á¶á“á›áŸ’á¢" }
        ];

        let staffName = "";
        let questions = [];
        let score = 0;
        let index = 0;

        // áŸ¡. á˜á»áá„á¶ášá”á¶á‰áŸ‹á‘á·á“áŸ’á“á“áŸá™ (Google Sheet Automation)
        function sendScoreToGoogle(name, finalScore) {
            const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSeDTCZHEGnvsvvkzUW30hvCE1A2O88kVUPHNzAqsAyngD0PTw/formResponse";
            const formData = new FormData();
            
            // á”áŸ’áŠá¼ášáá¶á˜á›áŸá Entry ID á€áŸ’á“á»á„á›á¸á„ášá”áŸáŸ‹á¢áŸ’á“á€
            formData.append("entry.574845234", name);       // áŸá˜áŸ’ášá¶á”áŸ‹ áˆáŸ’á˜áŸ„áŸ‡
            formData.append("entry.499524849", finalScore); // áŸá˜áŸ’ášá¶á”áŸ‹ á–á·á“áŸ’á‘á»

            fetch(formURL, { method: "POST", mode: "no-cors", body: formData })
            .catch(error => console.log("Sending issue: ", error));
        }

        function startTest() {
            staffName = document.getElementById('staffName').value.trim();
            if(!staffName) return alert("áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡áŸá·á“! / è¯·å…ˆè¾“å…¥å§“å");
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('quiz-box').style.display = 'block';
            questions = [...database].sort(() => 0.5 - Math.random()).slice(0, 10);
            loadNext();
        }

        function loadNext() {
            const q = questions[index];
            document.getElementById('wordDisplay').innerText = q.cn;
            document.getElementById('qNum').innerText = index + 1;
            document.getElementById('progressFill').style.width = (index / 10 * 100) + "%";
            
            setTimeout(playVoice, 500); // á¢á¶á“á¢á¼áá¼

            let options = database.filter(x => x.km !== q.km).sort(() => 0.5 - Math.random()).slice(0, 3);
            options.push(q);
            options.sort(() => 0.5 - Math.random());

            const grid = document.getElementById('optionsGrid');
            grid.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.km;
                btn.onclick = () => {
                    document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
                    if(opt.km === q.km) { btn.classList.add('correct'); score++; }
                    else { btn.classList.add('wrong'); }
                    
                    setTimeout(() => {
                        index++;
                        if(index < 10) loadNext();
                        else showResult();
                    }, 1200);
                };
                grid.appendChild(btn);
            });
        }

        function playVoice() {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(document.getElementById('wordDisplay').innerText);
            msg.lang = 'zh-CN';
            msg.rate = 0.8;
            window.speechSynthesis.speak(msg);
        }

        function showResult() {
            document.getElementById('quiz-box').style.display = 'none';
            document.getElementById('result-box').style.display = 'block';
            document.getElementById('finalScoreText').innerText = score + " / 10";
            
            const feedback = document.getElementById('feedbackText');
            if(score === 10) feedback.innerText = "á¢áŸáŸ’á…á¶ášáŸ’á™! á¢áŸ’á“á€á‚áºá‡á¶ QC á€áŸ†á–á¼á›! ğŸŒŸ";
            else if(score >= 7) feedback.innerText = "á›áŸ’á¢áá¶áŸáŸ‹! áŸáŸŠá¼áŸ—! ğŸ‘";
            else feedback.innerText = "ááŸ†á”áŸ’ášá¹á„ášáŸ€á“á”á“áŸ’ááŸ‚á˜á‘áŸ€ááá¶! ğŸ’ª";

            // á”á‰áŸ’á‡á¼á“á›á‘áŸ’á’á•á›á‘áŸ… Google Sheet á—áŸ’á›á¶á˜áŸ—
            sendScoreToGoogle(staffName, score);
        }
    </script>
</body>
</html>
